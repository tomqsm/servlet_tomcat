<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE urlrewrite PUBLIC "-//tuckey.org//DTD UrlRewrite 4.0//EN"
        "http://www.tuckey.org/res/dtds/urlrewrite4.0.dtd">
<urlrewrite use-context="false">
    <!--NOTE-->
    <!--conditions run first-->

    <!--LOGIN-->
    <rule enabled="true" match-type="regex">
        <name>loginFailureToCleanUrlEnglish</name>
        <note></note>
        <from>^(.*)/failed$</from>
        <set type="parameter" name="failed">true</set>
        <set name="log.info">loginFailureToCleanUrlEnglish</set>
        <run class="com.letsweb.tutorial.servlet_tomcat.rewriting.RewritingLogger" method="log"/>
        <to type="forward" last="true">$1</to>
    </rule>
    <rule enabled="true" match-type="regex">
        <name>loginFailureToCleanUrlPolish</name>
        <note></note>
        <from>^(.*)/nieudane$</from>
        <set type="parameter" name="failed">true</set>
        <set name="log.info">loginFailureToCleanUrlPolish</set>
        <run class="com.letsweb.tutorial.servlet_tomcat.rewriting.RewritingLogger" method="log"/>
        <to type="forward" last="true">$1</to>
    </rule>
    
    <!--START LANGUAGE TO URL GROUP runs on / root call-->
    <rule enabled="true" match-type="regex">
        <name>setBrowserLanguage</name>
        <condition type="method">GET</condition>
        <from>^/$</from>
        <run class="com.letsweb.tutorial.servlet_tomcat.rewriting.LocaleSetter" neweachtime="true"/>
        <set name="log.info">setBrowserLanguage: %{attribute:browserLanguage}</set>
        <run class="com.letsweb.tutorial.servlet_tomcat.rewriting.RewritingLogger" method="log"/>
    </rule>
    <rule enabled="true" match-type="regex">
        <name>browserLanguageNotPL->Redirect</name>
        <condition type="method">GET</condition>
        <condition type="attribute" name="browserLanguage" operator="notequal">^/$</condition>
        <set name="log.info">browserLanguageNotPL->Redirect: %{context-path}/%{attribute:browserLanguage}index</set>
        <run class="com.letsweb.tutorial.servlet_tomcat.rewriting.RewritingLogger" method="log"/>
        <from>^/$</from>
        <to type="temporary-redirect" last="true">%{context-path}/%{attribute:browserLanguage}/index</to>
    </rule>
    <rule enabled="true" match-type="regex">
        <name>browserLanguagePL->Forward</name>
        <condition type="method">GET</condition>
        <condition type="attribute" name="browserLanguage" operator="equal">^/$</condition>
        <set name="log.info">browserLanguagePL->Forward: %{request-uri} %{attribute:browserLanguage}index</set>
        <run class="com.letsweb.tutorial.servlet_tomcat.rewriting.RewritingLogger" method="log"/>
        <from>^/$</from>
        <to type="forward" last="true">%{attribute:browserLanguage}index</to>
    </rule>
    <!-- END LANGUAGE TO URL GROUP-->

    <rule enabled="true" match-type="regex">
        <name>Index rule 1</name>
        <note>Set locale 2.</note>
        <from>^(/angielski|/en/angielski)$</from>Wszystkiego dobrego w 
        <to type="forward">indexservlet?tk=true</to>
    </rule>
    
    <outbound-rule enabled="true" match-type="regex">
        <name>setLanguageFromRefererAndRequestPath</name>
        <run class="com.letsweb.tutorial.servlet_tomcat.rewriting.PageLanguageUrlResolver" method="setPathFromLang" />
        <run class="com.letsweb.tutorial.servlet_tomcat.rewriting.PageLanguageUrlResolver" method="setPathToLang" />
        <set name="log.info">setLanguageFromRefererAndRequestPath</set>
        <run class="com.letsweb.tutorial.servlet_tomcat.rewriting.RewritingLogger" method="log" />
        <from>^en(.*)$|^de(.*)$</from>
    </outbound-rule>

    <outbound-rule enabled="true" match-type="regex">
        <name>outboundRewriteForEN</name>
        <from>^en(.*)$</from>
        <set name="log.info">outboundRewriteForEN: fromServlet: %{attribute:fromServlet}, pathFromLang: %{attribute:pathFromLang}, pathToLang: %{attribute:pathToLang}</set>
        <run class="com.letsweb.tutorial.servlet_tomcat.rewriting.RewritingLogger" method="log" />
        <to last="true">%{context-path}/en${replace:$1:en/:}</to>
    </outbound-rule>
    
<!--    <outbound-rule enabled="true" match-type="regex">
        <name>outboundRewriteForDE</name>
        <from>^de(.*)$</from>
        <set name="log.info">outboundRewriteForDE: fromServlet: %{attribute:fromServlet}, pathFromLang: %{attribute:pathFromLang}, pathToLang: %{attribute:pathToLang}</set>
        <run class="com.letsweb.tutorial.servlet_tomcat.rewriting.RewritingLogger" method="log" />
        <to last="true">%{context-path}/de${replace:$1:de/:}</to>
    </outbound-rule>-->

    <outbound-rule enabled="true" match-type="regex">
        <name>outboundRewriteForPL</name>
        <from>^pl(.*)$</from>
        <set name="log.info">outboundRewriteForPL: %{request-uri} fromServlet: %{attribute:fromServlet}, pathFromLang: %{attribute:pathFromLang}, pathToLang: %{attribute:pathToLang}</set>
        <run class="com.letsweb.tutorial.servlet_tomcat.rewriting.RewritingLogger" method="log" />
        <to last="true">%{context-path}${replace:$1:en/:}</to>
    </outbound-rule>

    
    <rule enabled="true" match-type="regex">
        <condition type="method">GET</condition>
        <from>^/$|^/en/$</from>
        <run class="com.letsweb.tutorial.servlet_tomcat.pages.LandingController" method="doGet" />
        <to type="forward" last="true">template.ftl</to>
    </rule>
    
    <rule enabled="true" match-type="regex">
        <condition type="method">GET</condition>
        <from>/links</from>
        <run class="com.letsweb.tutorial.servlet_tomcat.pages.LinksController" method="doGet" />
        <to type="forward">template.ftl</to>
    </rule>
    
    <rule enabled="true" match-type="regex">
        <condition type="method">GET</condition>
        <from>^/en/podlogi$</from>
        <run class="com.letsweb.tutorial.servlet_tomcat.pages.LinksController" method="doGetPodlogi" />
        <to type="forward">template.ftl</to>
    </rule>
    <rule enabled="true" match-type="regex">
        <condition type="method">GET</condition>
        <from>^/podlogi$</from>
        <run class="com.letsweb.tutorial.servlet_tomcat.pages.LinksController" method="doGetPodlogi" />
        <to type="forward">template.ftl</to>
    </rule>

    
</urlrewrite>
